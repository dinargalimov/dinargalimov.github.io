@import 'variables.styl'

.messenger
	position fixed
	bottom 0
	right 0
	z-index 1500
	min-width 320px
	max-width 550px
	width 28%
	background #fff
	box-shadow 0px 3px 20px 0px rgba(cl1,0.3)

	&.hide
		display block!important
		animation pageHide .5s ease both
		pointer-events none

	&.open
		animation pageOpen .5s ease both

	&.ng-hide-add
		opacity 1
	&.ng-hide-add-active
		opacity 0
		transform translateX(150px)

	&.ng-hide-remove
		opacity 0
		transform translateX(150px)
	&.ng-hide-remove-active
		opacity 1
		transform translateX(0px)


	.fullsize
		.messenger_theme_list, .messenger_chat_container, .messenger_new_theme
			height calc(100vh - 40px - 42px)


		.messenger_new_theme
			.add_text
				textarea
					min-height 240px
					max-height 240px
			.file_upload_list
				max-height calc(100vh - 40px - 42px - 455px)
				min-height 100px


		.icon-arrow-up
			&:before
				transform rotate(180deg)
			&:hover
				transform translateY(3px)
				&:before
					transform rotate(180deg)

	.messenger_chat
		.item
			&.right
				.photo
					display none
				.name
					display none


.messenger_header
	height 45px
	background cl2
	// border-bottom 3px solid cl4

.messenger_header_action
	float right
	padding 0 5px 0 0
	a[class*='icon-']
		height 45px
		width 25px
		float right
		line-height 45px
		color #fff

	a[class*='icon-arrow-up']
		transition  .2s
		&:hover
			transform translateY(-3px)

// шапка чата
.messenger_header_title
	padding 11px 0 0 10px
	font-size fzn
	font-weight normal
	display inline-block
	a
		color #fff
		transition color .1s
		text-decoration none
		&:hover
			opacity 0.9

.messenger_main
	width 100%

// список всех тем
.messenger_theme_list
	max-height calc(100vh - 40px - 42px)
	height 430px
	overflow auto
	transition .3s
	-webkit-overflow-scrolling touch

.messenger_theme_item
	margin -1px 0 0
	clearfix()
	font-size fzn - 2px
	&:after
		content ''
		display block
		height 1px
		background cbd + 50%
		margin -1px 10px 0 20px
		z-index 0
	&.new
		.message
			color ctext
		&:before
			content ''
			width 10px
			height 10px
			border-radius 50%
			background cl3
			position absolute
			left 5px
			top calc(50% - 5px)
			z-index 20
	a
		position relative
		z-index 10
		text-decoration none
		display block
		padding 13px 10px 13px 20px
		line-height 14px
		overflow hidden
		&:hover
			background cbghighlight
	.photo
		float left
		width 50px
		height 50px
		font-size 25px

	.desc
		display block
		margin 0 0 0 60px
	.date
		float right
		font-size fzn - 4px
		color ctextlight
	.name
		font-weight fwm
		display inline-block
		margin 0 0 3px
		color ctext
		overflow ellipsis
		max-width 72%
		font-size fzn - 3px
	.message
		font-size fzn - 4px
		color ctextlight
		max-height 30px
		overflow hidden
		display block
		margin-right 30px
	.write_now
		position absolute
		top 30px
		right 10px
		z-index 10

	&.theme_closed
		.desc
			opacity 0.4
		.photo
			img
				opacity 0.4
			&:after
				content ''
				width 30px
				height 30px
				position absolute
				top 50%
				left 50%
				margin -15px 0 0 -15px
				background #fff url(../images/icon_check.svg) no-repeat center
				border-radius 30px


// оформление чата
.messenger_chat_container
	display flex
	flex-direction column
	height 430px
	max-height calc(100vh - 40px - 42px)
	transition height .3s

.messenger_chat
	padding 5px 15px 18px
	overflow auto
	box-sizing border-box
	-webkit-overflow-scrolling touch
	flex 1 1500 auto
	.item
		margin 0 0 20px
		font-size fzn - 2px
		&.right
			.date
				left 0
				top calc(50% - 8px)
			.desc
				margin-left 60px
				margin-right 0
			.message
				color ctext
				background cl4 + 85%
				a
					color clink
					&:hover
						color cl2
		&.deleted
			.message
				font-style italic
				color ctextlight
		&.to_agents
			.message
				background #F9ECDD

		// &:not(.right) + .item:not(.right)
		// 	margin-top -15px
		// 	figure, .name
		// 		display none
		// 	.date
		// 		top calc(50% - 8px)
		// &.right + .item.right
		// 	margin-top -15px
		// 	figure, .name
		// 		display none
		// 	.date
		// 		top calc(50% - 8px)
	.desc
		margin-right 60px
	.date
		position absolute
		top calc(50% + 5px)
		right 0
		color ctextlight
		font-size fzn - 4px
	.date_top
		font-size fzn - 4px
		color ctextlight
		display inline-block
		float right
		margin 4px 0 0 0
		.button_clean_dropdown
			vertical-align top
			margin-left 10px
	.photo
		display inline-block
		vertical-align middle
		z-index 10
		width 25px
		height 25px
		margin 0 3px 4px 0px
		font-size 13px

	.name
		display inline-block
		vertical-align middle
		font-weight fwn
		color ctext
		overflow ellipsis
		max-width 84%
		overflow ellipssis
		font-size fzn - 3px
		margin 0 0 4px

	.message_edit
		// float right
		color ctextlight
		z-index 10
		font-size fzn - 4px
		margin-left 5px
		&:before
			width auto
			min-width auto
			margin 0

	.message
		z-index 0
		background cbgsuccess
		border-radius 12px
		padding 10px 13px 16px
		margin 0
		word-wrap break-word
		a
			word-break break-all
			// color #fff
			&:hover
				// opacity 0.9
		[class*='icon-']
			&:before
				min-width 0

		.submessage
			background #fff
			border-radius 8px
			padding 10px
			font-style italic
			margin -2px -5px 10px
			.submessage_date
				color ctextlight
				font-size fzn - 4px

	.message_info
		margin-left 5px
		cursor pointer
		&:before
			margin 0
	.message_file_attachments
		margin 5px 0 0
		li
			padding 3px 0

	.info_message
		margin 20px 0 0
		text-align center
		font-size fzn - 4px
		color ctextlight
		&[class*="icon-"]
			&:before
				font-size 20px
				display block
				text-align center
				margin-bottom 5px
				margin-right 0

		.cancel_chat
			background cseparator
			font-size fzn - 4px
			color ctextlight
			border-radius 20px
			display inline-block
			padding 5px 10px
			text-decoration none
			color clinklight
			&:hover
				background cseparator + 20%

	.thumbs
		padding 5px 0 0
		text-align center
		.thumbs_up, .thumbs_down
			display inline-block
			font-size 15px
			margin 0
			background cseparator
			width 26px
			height 26px
			border-radius 50px
			line-height 24px
			overflow hidden
			color clinklight
			&:before
				margin-right 0
				min-width 0
		.thumbs_down
			line-height 27px

		a.thumbs_down:hover
			background cerror
			color #fff

		a.thumbs_up:hover
			background cl3
			color #fff

		span.thumbs_down
			background cerror
			color #fff

		span.thumbs_up
			background cl3
			color #fff


	.write_now
		position absolute
		padding-left 0
		color ctextlight

	.add_new_task_for_message
		position absolute
		top 50%
		right 0
		margin -15px 0 0
		a
			display inline-block
			border-radius 100px
			background cseparator
			font-size 24px
			text-align center
			line-height 50px
			width 50px
			height 50px
			color #fff
			transition background .2s, opacity .2s, transform .2s
			opacity 0
			transform scale(.5)
			&:before
				margin 0
				min-width 0
			&:hover
				background @background - 5%
		&.show
			a
				transform scale(1)
				opacity 1




// инфо сообщение после первого сообщения
.first_message_add
	margin 20px 0
	// padding 35px 15px 0
	text-align center
	// background url(../images/chat_smile.svg) no-repeat center 0
	font-size fzn - 4px
	color ctextlight
	&:before
		font-family: "mb-icon-font"
		content '|'
		font-size fzn
		color ctextlight
		display block
		font-size fzn + 6px

// разделитель в чате
.messenger_sep_title
	margin 20px 0 27px
	text-align center
	font-size fzn - 4px
	color ctextlight
	border-bottom 1px solid cbd
	height 8px
	&:first-child
		margin-top 5px
		margin-bottom 20px
	>span
		position relative
		background #fff
		padding 0 10px





// блок добавления комментария
.add_message
	z-index 100
	padding 5px 15px 10px
	background #fff
	box-sizing border-box
	clearfix()
	.add_text,.add_buttons
		float left
	.add_text
		width 84%
		textarea
			width 100%
			font-size fzn - 2px
			padding-right 40px
			overflow auto
			-webkit-overflow-scrolling touch
			box-shadow none
			&:focus
				border-color cbd
		.button_file_upload
			color ctextlight
			position absolute
			right 12px
			top 0
			width 30px
			height 42px
			text-align center
			line-height 42px
			&:hover
				color ctext
	.add_buttons
		width 15%
		margin-left 1%



	.add_message_tabs
		margin-bottom -1px
		z-index 10
		a
			font-size fzn - 2px
			color ctextlight
			padding 10px 40px
			background #f1f1f1
			display inline-block
			text-decoration none
			vertical-align 0
			&:hover
				background #f4f4f4
			&.active
				background #fff
				border 1px solid cbd
				border-top-width 2px
				border-bottom-color #fff
				z-index 10
				&.color1
					border-top-color cl3
				&.color2
					border-top-color cl2
			&.disabled
				cursor default
				background #f1f1f1
				color ctextdis

	// новое сообщение в админке
	.add_message_textarea
		margin 0 0 10px
		textarea
			width 100%
			min-height 76px
			max-height 40vh
			font-size fzn - 2px
			box-shadow none
			box-sizing border-box
			padding-bottom 20px
			&:focus
				border-color cbd

	// кнопки в админке
	.add_message_buttons
		.add_message_send
			float right
		.file_attach
			font-size fzn - 2px
			padding 10px 0 0
			overflow hidden
		.button_file_upload
			color clinklight
			&:hover
				color cl2


	// загруженнные файлы
	.file_upload_list
		clear both
		max-height 100px
		overflow auto
		padding-top 10px
		margin-right -10px
		padding-right 10px
		-webkit-overflow-scrolling touch



// открытие новой темы
.messenger_new_theme
	color ctextlight
	box-shadow none
	max-height calc(100vh - 40px - 42px)
	overflow auto

	.add_text, .add_buttons
		float none
	.add_text
		width 100%
		margin-top 20px

		textarea
			width 100%
			min-height 210px
			font-size fzn - 2px

	.add_buttons
		width 100%
		margin 10px 0 0

.chat_new_theme_info
	text-align center
	font-weight normal
	font-size fzn - 2px
	padding 79px 15px 15px
	background url(../images/new_theme_back.svg) no-repeat center 12px
	background-size 40px auto
	color ctextlight

.messenger_theme_empty
	background url(../images/icon_chats.svg) no-repeat center 50px, url(../images/icon_chats_arrow.svg) no-repeat 60px 15px
	padding  135px 45px 0
	text-align center
	font-size fzn - 3px
	color ctextlight
	.title
		font-size fzn - 1px
		color clinklight
		margin 0 0 20px
		font-weight 400


// ---------- чат в слое --------------

.page_messenger_main
	position absolute
	top 0
	left 0
	right 0
	bottom 0
	overflow hidden
	display flex
	flex-direction column
	-webkit-overflow-scrolling touch

	.messenger_chat
		padding 10px 30px 0px
		overflow auto
		height auto
		box-sizing border-box
		transition none
		flex 1 1500 auto
		-webkit-overflow-scrolling touch

		.item
			// font-size fzn - 2px

		.desc
			// margin-right 100px
		.item.right
			.desc
				// margin-left 100px
		.name
			max-width 60%

		.write_now
			position relative
			padding-left 0
			color ctextlight
			height 0px

		#messageLast
			display block
			height 20px

	.messenger_sep_title
		margin 30px 0
		height auto
		border-bottom none

		>span
			border none
			padding 5px 10px
			display inline-block
			line-height 1.2
			border-radius 12px
			background #f1f1f1
			a
				color clink
				text-decoration none
				&:hover
					color cl2
					text-decoration underline
		.sep_date
			display inline-block
			text-transform capitalize
			padding-right 10px
			margin-right 10px
			border-right 1px solid cbd
		.sep_text
			text-align left
			line-height 1.3

	.add_message
		padding 10px 30px

// индикатора доставки
.indicator_send
	position absolute
	right 5px
	bottom 4px
	font-size 10px
	color cl2
	&:before, &:after
		font-family: "mb-icon-font"
		content '{'
		display inline
		opacity 0
		transition opacity .2s
	&:after
		margin-left -5px
	&.delivered
		&:before
			opacity 1
	&.read
		&:before, &:after
			opacity 1