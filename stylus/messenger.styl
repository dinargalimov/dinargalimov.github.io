@import 'variables.styl'

.messenger
	position fixed
	bottom 0
	right 0
	top 60rem
	z-index 2500
	// min-width 320rem
	// max-width 550rem
	// width 28%
	width 400rem
	background #fff
	box-shadow -4rem 0rem 30rem rgba(cl1,0.25)
	&.hide
		display block!important
		animation pageHide .5s ease both
		pointer-events none

	&.open
		animation pageOpen .5s ease both

	&.ng-hide-add
		opacity 1
	&.ng-hide-add-active
		opacity 0
		transform translateX(150rem)

	&.ng-hide-remove
		opacity 0
		transform translateX(150rem)
	&.ng-hide-remove-active
		opacity 1
		transform translateX(0rem)

	&>div:not([class*='messenger_'])
		height 100%
	.fullsize
		.messenger_theme_list, .messenger_chat_container, .messenger_new_theme
			height calc(100vh - 40rem - 42rem)


		.messenger_new_theme
			.add_text
				textarea
					min-height 240rem
					max-height 240rem
			.file_upload_list
				max-height calc(100vh - 40rem - 42rem - 455rem)
				min-height 100rem


		.icon-arrow-up
			&:before
				transform rotate(180deg)
			&:hover
				transform translateY(3rem)
				&:before
					transform rotate(180deg)

	.messenger_chat
		.item
			&.right
				.photo
					display none
				.name
					display none


.messenger_header
	height 40rem
	background cbgsky
	border-bottom 1rem solid cbd

.messenger_header_action
	float right
	padding 0 5rem 0 0
	a[class*='icon-']
		margin-right 5rem
		height 40rem
		width 30rem
		text-align center
		float right
		line-height 45rem
		color ctextlight
		&:before
			margin 0

	a[class*='icon-arrow-up']
		display none
		transition  .2s
		font-size 20rem
		&:hover
			transform translateY(-3rem)


// шапка чата
.messenger_header_title
	padding 11rem 0 0 15rem
	font-size fzn
	font-weight normal
	display inline-block
	a
		color ctextlight
		transition color .1s
		text-decoration none
		&:hover
			opacity 0.9

.messenger_main
	width 100%
	height calc(100% - 45rem)

// список всех тем
.messenger_theme_list
	// max-height calc(100vh - 40rem - 42rem)
	// height 430rem
	height 100%
	overflow auto
	transition .3s
	-webkit-overflow-scrolling touch

.messenger_theme_item
	margin -1rem 0 0
	clearfix()
	font-size fzn
	&:after
		content ''
		display block
		height 1rem
		background cbd + 50%
		margin -1rem 10rem 0 80rem
		z-index 0
	&.new
		.message
			color ctext
		&:before
			content ''
			width 10rem
			height 10rem
			border-radius 50%
			background cl3
			position absolute
			left 5rem
			top calc(50% - 5rem)
			z-index 20
	a
		position relative
		z-index 10
		text-decoration none
		display block
		padding 15rem 20rem 15rem 20rem
		overflow hidden
		&:hover
			background cbghighlight
	.photo
		float left
		width 50rem
		height 50rem
		font-size 25rem

	.desc
		display block
		margin 0 0 0 60rem
	.date
		float right
		font-size fzn - 4rem
		color ctextlight
	.name
		font-weight fwm
		display inline-block
		margin 0
		color ctext
		overflow ellipsis
		max-width 72%
		font-size fzn - 2rem
	.message
		font-size fzn - 2rem
		color ctextlight
		max-height 36rem
		overflow hidden
		display block
		margin-right 30rem
	.write_now
		position absolute
		top 30rem
		right 10rem
		z-index 10

	&.theme_closed
		.desc
			opacity 0.4
		.photo
			img
				opacity 0.4
			&:after
				content ''
				width 30rem
				height 30rem
				position absolute
				top 50%
				left 50%
				margin -15rem 0 0 -15rem
				background #fff url(../images/icon_check.svg) no-repeat center
				border-radius 30rem


// оформление чата
.messenger_chat_container
	display flex
	flex-direction column
	// height 430rem
	// max-height calc(100% - 45rem - 60rem)
	height 100%
	transition height .3s

.messenger_chat
	padding 5rem 15rem 18rem
	overflow auto
	box-sizing border-box
	-webkit-overflow-scrolling touch
	flex 1 1500 auto
	.item
		margin 0 0 20rem
		font-size fzn - 2rem
		&.right
			.date
				left 0
				top calc(50% - 8rem)
			.desc
				margin-left 60rem
				margin-right 0
			.message
				color ctext
				background cl4 + 85%
				a
					color clink
					&:hover
						color cl2
		&.deleted
			.message
				font-style italic
				color ctextlight
		&.to_agents
			.message
				background #F9ECDD

		// &:not(.right) + .item:not(.right)
		// 	margin-top -15rem
		// 	figure, .name
		// 		display none
		// 	.date
		// 		top calc(50% - 8rem)
		// &.right + .item.right
		// 	margin-top -15rem
		// 	figure, .name
		// 		display none
		// 	.date
		// 		top calc(50% - 8rem)
	.desc
		margin-right 60rem
	.date
		position absolute
		top calc(50% + 5rem)
		right 0
		color ctextlight
		font-size fzn - 4rem
	.date_top
		font-size fzn - 4rem
		color ctextlight
		display inline-block
		float right
		margin 4rem 0 0 0
		.button_clean_dropdown
			vertical-align top
			margin-left 10rem
	.photo
		display inline-block
		vertical-align middle
		z-index 10
		width 25rem
		height 25rem
		margin 0 3rem 4rem 0rem
		font-size 13rem

	.name
		display inline-block
		vertical-align middle
		font-weight fwm
		color ctext
		overflow ellipsis
		max-width 84%
		overflow ellipssis
		font-size fzn - 2rem
		margin 0 0 4rem

	.message_edit
		// float right
		color ctextlight
		z-index 10
		font-size fzn - 4rem
		margin-left 5rem
		&:before
			width auto
			min-width auto
			margin 0

	.message
		z-index 0
		background cbgsuccess
		border-radius 12rem
		padding 10rem 13rem 16rem
		margin 0
		word-wrap break-word
		a
			word-break break-all
			// color #fff
			&:hover
				// opacity 0.9
		[class*='icon-']
			&:before
				min-width 0

		.submessage
			background #fff
			border-radius 8rem
			padding 10rem
			font-style italic
			margin -2rem -5rem 10rem
			.submessage_date
				color ctextlight
				font-size fzn - 4rem

	.message_info
		margin-left 5rem
		cursor pointer
		&:before
			margin 0
	.message_file_attachments
		margin 5rem 0 0
		li
			padding 3rem 0

	.info_message
		margin 20rem 0 0
		text-align center
		font-size fzn - 4rem
		color ctextlight
		&[class*="icon-"]
			&:before
				font-size 20rem
				display block
				text-align center
				margin-bottom 5rem
				margin-right 0

		.cancel_chat
			background cbglight
			font-size fzn - 4rem
			color ctext
			border-radius 20rem
			display inline-block
			padding 5rem 10rem
			text-decoration none
			&:hover
				background cseparator + 20%

	.thumbs
		padding 5rem 0 0
		text-align center
		.thumbs_up, .thumbs_down
			display inline-block
			font-size 15rem
			margin 0
			background cbglight
			width 32rem
			height 32rem
			border-radius 50rem
			line-height 32rem
			overflow hidden
			color ctext
			&:before
				margin-right 0
				min-width 0
		.thumbs_down
			line-height 37rem

		a.thumbs_down:hover
			background cerror
			color #fff

		a.thumbs_up:hover
			background cl3
			color #fff

		span.thumbs_down
			background cerror
			color #fff

		span.thumbs_up
			background cl3
			color #fff


	.write_now
		position absolute
		padding-left 0
		color ctextlight

	.add_new_task_for_message
		position absolute
		top 50%
		right 0
		margin -15rem 0 0
		a
			display inline-block
			border-radius 100rem
			background cseparator
			font-size 24rem
			text-align center
			line-height 50rem
			width 50rem
			height 50rem
			color #fff
			transition background .2s, opacity .2s, transform .2s
			opacity 0
			transform scale(.5)
			&:before
				margin 0
				min-width 0
			&:hover
				background @background - 5%
		&.show
			a
				transform scale(1)
				opacity 1




// инфо сообщение после первого сообщения
.first_message_add
	margin 20rem 0
	// padding 35rem 15rem 0
	text-align center
	// background url(../images/chat_smile.svg) no-repeat center 0
	font-size fzn - 4rem
	color ctextlight
	&:before
		font-family: "mb-icon-font-3"
		content '|'
		font-size fzn
		color ctextlight
		display block
		font-size fzn + 6rem

// разделитель в чате
.messenger_sep_title
	margin 20rem 0 27rem
	text-align center
	font-size fzn - 4rem
	color ctextlight
	border-bottom 1rem solid cbd
	height 8rem
	&:first-child
		margin-top 5rem
		margin-bottom 20rem
	>span
		position relative
		background #fff
		padding 0 10rem





// блок добавления комментария
.add_message
	z-index 100
	padding 5rem 15rem 10rem
	background #fff
	box-sizing border-box
	clearfix()
	.add_text,.add_buttons
		float left
	.add_text
		width 84%
		textarea
			width 100%
			font-size fzn - 2rem
			padding-right 40rem
			overflow auto
			-webkit-overflow-scrolling touch
			box-shadow none
			&:focus
				border-color cbd
		.button_file_upload
			color ctextlight
			position absolute
			right 12rem
			top 0
			width 30rem
			height 44rem
			text-align center
			line-height 46rem
			&:hover
				color ctext
			&:before
				color ctextlight
	.add_buttons
		width 15%
		margin-left 1%



	.add_message_tabs
		margin-bottom -1rem
		z-index 10
		a
			font-size fzn - 2rem
			color ctextlight
			padding 10rem 40rem
			background #f1f1f1
			display inline-block
			text-decoration none
			vertical-align 0
			&:hover
				background #f4f4f4
			&.active
				background #fff
				border 1rem solid cbd
				border-top-width 2rem
				border-bottom-color #fff
				z-index 10
				&.color1
					border-top-color cl3
				&.color2
					border-top-color cl2
			&.disabled
				cursor default
				background #f1f1f1
				color ctextdis

	// новое сообщение в админке
	.add_message_textarea
		margin 0 0 10rem
		textarea
			width 100%
			min-height 76rem
			max-height 40vh
			font-size fzn - 2rem
			box-shadow none
			box-sizing border-box
			padding-bottom 20rem
			&:focus
				border-color cbd

	// кнопки в админке
	.add_message_buttons
		.add_message_send
			float right
		.file_attach
			font-size fzn - 2rem
			padding 10rem 0 0
			overflow hidden
		.button_file_upload
			color ctextlight
			&:hover
				color cl2


	// загруженнные файлы
	.file_upload_list
		clear both
		max-height 100rem
		overflow auto
		padding-top 10rem
		margin-right -10rem
		padding-right 10rem
		-webkit-overflow-scrolling touch



// открытие новой темы
.messenger_new_theme
	color ctextlight
	box-shadow none
	height calc(100vh - 60rem - 42rem)
	overflow auto
	display flex
	flex-direction column
	justify-content space-between

	.add_text, .add_buttons
		float none
	.add_text
		width 100%
		margin-top 20rem

		textarea
			width 100%
			min-height 210rem
			font-size fzn - 2rem

	.add_buttons
		width 100%
		margin 10rem 0 0

	.file_upload_list
		flex 0 0 auto

.chat_new_theme_info
	text-align center
	font-weight normal
	font-size fzn - 2rem
	padding 79rem 15rem 15rem
	background url(../images/new_theme_back.svg) no-repeat center 12rem
	background-size 40rem auto
	color ctextlight
	flex 1 1 10%

.messenger_theme_empty
	background url(../images/icon_chats.svg) no-repeat center 50rem, url(../images/icon_chats_arrow.svg) no-repeat 60rem 15rem
	padding  135rem 45rem 0
	text-align center
	font-size fzn - 3rem
	color ctextlight
	.title
		font-size fzn - 1rem
		color clinklight
		margin 0 0 20rem
		font-weight 400


// ---------- чат в слое --------------

.page_messenger_main
	position absolute
	top 0
	left 0
	right 0
	bottom 0
	overflow hidden
	display flex
	flex-direction column
	-webkit-overflow-scrolling touch

	.messenger_chat
		padding 10rem 30rem 0rem
		overflow auto
		height auto
		box-sizing border-box
		transition none
		flex 1 1500 auto
		-webkit-overflow-scrolling touch

		.item
			// font-size fzn - 2rem

		.desc
			// margin-right 100rem
		.item.right
			.desc
				// margin-left 100rem
		.name
			max-width 60%

		.write_now
			position relative
			padding-left 0
			color ctextlight
			height 0rem

		#messageLast
			display block
			height 20rem

	.messenger_sep_title
		margin 30rem 0
		height auto
		border-bottom none

		>span
			border none
			padding 5rem 10rem
			display inline-block
			line-height 1.2
			border-radius 12rem
			background #f1f1f1

		.sep_date
			display inline-block
			text-transform capitalize
			padding-right 10rem
			margin-right 10rem
			border-right 1rem solid cbd
		.sep_text
			text-align left
			line-height 1.3

	.add_message
		padding 10rem 30rem

// индикатора доставки
.indicator_send
	position absolute
	right 5rem
	bottom 4rem
	font-size 10rem
	color cl2
	width 24rem
	text-align right
	&:before, &:after
		font-family: "mb-icon-font-3"
		content '{'
		display inline
		opacity 0
		transition opacity .2s
	&:after
		margin-left -5rem
	&.delivered
		&:before
			opacity 1
	&.read
		&:before, &:after
			opacity 1